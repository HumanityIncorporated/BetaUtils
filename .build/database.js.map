{
  "version": 3,
  "sources": ["../database.ts"],
  "sourcesContent": ["const { MongoClient } = require(\"mongodb\");\nimport {authDB, msgDB} from './consts';\n\n// Replace the uri string with your connection string.\nconst uri = \n  `mongodb+srv://SystemLogin:${process.env['dbPwd']}@betaos-datacluster00.d8o7x8n.mongodb.net/?retryWrites=true&w=majority`\n  // \"mongodb://SystemLogin:\"+process.env['dbPwd']+\"@ac-rz8jdrl-shard-00-00.d8o7x8n.mongodb.net:27017,ac-rz8jdrl-shard-00-01.d8o7x8n.mongodb.net:27017,ac-rz8jdrl-shard-00-02.d8o7x8n.mongodb.net:27017/?ssl=true&replicaSet=atlas-3yyxq8-shard-0&authSource=admin&retryWrites=true&w=majority\";\n  // \"mongodb+srv://SystemLogin:\"+process.env['dbPwd']+\"@betaos-datacluster00.d8o7x8n.mongodb.net/?retryWrites=true&w=majority\";\n\nimport {DBConnectFailure} from './index';\nexport const client = new MongoClient(uri)//, { useNewUrlParser: true, useUnifiedTopology: true });\n// const client = cli.connect();\nexport async function connectDB() {\n  try {\n    await client.connect();  \n    clearTimeout(DBConnectFailure)\n    return null;\n  }\n  catch(e:any) {\n    console.log(e);\n    return e;\n    \n  }\n}\nexport const database = client.db('BetaOS-Database01');\n// export const DB = database.collection('BetaUtilities');\n\nexport async function DBMaintenance() {\n  let items:{associatedUser:string, expiry:number}[] = await authDB.find({fieldName:\"Token\"}).toArray();\n  for (let i=0; i<items.length; i++) {\n    if (!items[i].expiry || items[i].expiry < Date.now()) {\n      console.log(\"Token from \"+items[i].associatedUser + \" has expired\");\n      await authDB.deleteOne(items[i]);\n    }\n  }\n  let items2:{sender:string, expiry:number}[] = await msgDB.find({fieldName:\"MSG\"}).toArray();\n  for (let i=0; i<items2.length; i++) {\n    if (!items2[i].expiry || items2[i].expiry < Date.now()) {\n      console.log(\"Message from \"+items2[i].sender + \" has expired\");\n      await msgDB.deleteOne(items2[i]);\n    }\n  };\n  setTimeout(DBMaintenance, 1000);\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,oBAA4B;AAQ5B,mBAA+B;AAT/B,MAAM,EAAE,YAAY,IAAI,QAAQ,SAAS;AAIzC,MAAM,MACJ,6BAA6B,QAAQ,IAAI;AAKpC,MAAM,SAAS,IAAI,YAAY,GAAG;AAEzC,eAAsB,YAAY;AAChC,MAAI;AACF,UAAM,OAAO,QAAQ;AACrB,iBAAa,6BAAgB;AAC7B,WAAO;AAAA,EACT,SACM,GAAN;AACE,YAAQ,IAAI,CAAC;AACb,WAAO;AAAA,EAET;AACF;AACO,MAAM,WAAW,OAAO,GAAG,mBAAmB;AAGrD,eAAsB,gBAAgB;AACpC,MAAI,QAAiD,MAAM,qBAAO,KAAK,EAAC,WAAU,QAAO,CAAC,EAAE,QAAQ;AACpG,WAAS,IAAE,GAAG,IAAE,MAAM,QAAQ,KAAK;AACjC,QAAI,CAAC,MAAM,GAAG,UAAU,MAAM,GAAG,SAAS,KAAK,IAAI,GAAG;AACpD,cAAQ,IAAI,gBAAc,MAAM,GAAG,iBAAiB,cAAc;AAClE,YAAM,qBAAO,UAAU,MAAM,EAAE;AAAA,IACjC;AAAA,EACF;AACA,MAAI,SAA0C,MAAM,oBAAM,KAAK,EAAC,WAAU,MAAK,CAAC,EAAE,QAAQ;AAC1F,WAAS,IAAE,GAAG,IAAE,OAAO,QAAQ,KAAK;AAClC,QAAI,CAAC,OAAO,GAAG,UAAU,OAAO,GAAG,SAAS,KAAK,IAAI,GAAG;AACtD,cAAQ,IAAI,kBAAgB,OAAO,GAAG,SAAS,cAAc;AAC7D,YAAM,oBAAM,UAAU,OAAO,EAAE;AAAA,IACjC;AAAA,EACF;AAAC;AACD,aAAW,eAAe,GAAI;AAChC;",
  "names": []
}

{
  "version": 3,
  "sources": ["../index.ts"],
  "sourcesContent": ["import {initServer} from './server';\nimport {DBMaintenance, connectDB, client} from './database';\nimport {supportHandler, Room} from './supportRooms'\nimport {log} from './logging';\nconst fs = require('fs');\nimport {uDB} from './consts';\nimport {WS} from './betautilities/wsHandler';\nimport {WebH} from './betautilities/webHandler';\nimport { serverUpdate } from './betautilities/wordler';\nexport let connectionSuccess = true;\nexport let DBConnectFailure:any = null;\nimport {mail} from './mailer';\nconst localEuphRooms = [\n  // \"bots\", \"room\", \"memes\", \"music\", \"srs\"\n]\nconst { exec } = require(\"child_process\");\n\nexport let UPSINCESTR = \"\";\ntry {\n  // mail();\n  // let fs = \n  if (connectionSuccess)\n  connectDB().then((err:any)=>{\n    // console.log(thing)\n    if (!connectionSuccess) return;\n    uDB.findOne({fieldName:\"ROOMS\"})\n    let readline = require('readline');\n\n    let rl = readline.createInterface({\n      input: process.stdin,\n      output: process.stdout\n    \n    });\n    \n    rl.question(\"Confirm start extra instance? \", (answer:string)=>{\n      rl.close();\n      answer = answer.trim().toLowerCase();\n      if (answer != \"y\" && answer != \"yes\") exec(\"kill\")\n      else {\n        init()\n      } // extra instances approved\n    });\n\n  // init();\n  });\n  DBConnectFailure = setTimeout(()=>{\n    connectionSuccess=false; \n    console.log(\"Connection failed\")\n    log(\"Services failed. Rebooting now.\")\n    initServer();\n    serverUpdate();\n    setTimeout(()=>{exec(\"kill 1\")}, 10000);\n  }, 29000);\n} catch (e:any) {\n  console.log(e);\n}\n\nasync function init() \n{\n  initServer();\n  DBMaintenance();\n  serverUpdate();\n  let now = new Date(Date.now());\n  UPSINCESTR = \"----------------------Systems restarted at \"+now.toLocaleString(\"en-US\", {timeZone: \"America/New_York\"})+\"-------------------\";\n  log(UPSINCESTR);\n  uDB.findOne({fieldName:\"ROOMS\"}).then((obj:{euphRooms:string[], rooms:string[], hidRooms:string[]})=>{\n    console.log(obj);\n    for (let i=0; i<obj.euphRooms.length; i++) {\n      supportHandler.addRoom(new Room(\"EUPH_ROOM\", obj.euphRooms[i]));\n      new WS(\"wss://euphoria.io/room/\" + obj.euphRooms[i] +\"/ws\", \"BetaUtilities\", obj.euphRooms[i], !(obj.euphRooms[i]==\"test\" || obj.euphRooms[i]==\"bots\"))\n      log(\"Connected euph_room\")+obj.euphRooms[i];\n      console.log(\"Connected euph_room\", obj.euphRooms[i]);\n    }\n    // for (let i=0; i<localEuphRooms.length; i++) {\n    //   supportHandler.addRoom(new Room(\"EUPH_ROOM\", localEuphRooms[i]));\n    //   new WS(\"wss://euphoria.io/room/\" + localEuphRooms[i] +\"/ws\", \"BetaUtilities\", localEuphRooms[i], false)\n    //   log(\"Connected euph_room\")+localEuphRooms[i];\n    //   console.log(\"Connected euph_room\", localEuphRooms[i]);\n    // }\n    for (let i=0; i<obj.rooms.length; i++) {\n      new WebH(obj.rooms[i], false);\n      //supportHandler.addRoom(new Room(\"ONLINE_SUPPORT\", obj.rooms[i]));\n      console.log(\"Loaded support room\", obj.rooms[i]);\n    }\n    for (let i=0; i<obj.hidRooms.length; i++) {\n      new WebH(obj.hidRooms[i], true);\n      // supportHandler.addRoom(new Room(\"HIDDEN_SUPPORT\", obj.hidRooms[i]));\n      console.log(\"Loaded hidden support room\", obj.hidRooms[i]);\n    }\n  })\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAyB;AACzB,sBAA+C;AAC/C,0BAAmC;AACnC,qBAAkB;AAElB,oBAAkB;AAClB,uBAAiB;AACjB,wBAAmB;AACnB,qBAA6B;AAJ7B,MAAM,KAAK,QAAQ,IAAI;AAKhB,IAAI,oBAAoB;AACxB,IAAI,mBAAuB;AAElC,MAAM,iBAAiB,CAEvB;AACA,MAAM,EAAE,KAAK,IAAI,QAAQ,eAAe;AAEjC,IAAI,aAAa;AACxB,IAAI;AAGF,MAAI;AACJ,mCAAU,EAAE,KAAK,CAAC,QAAU;AAE1B,UAAI,CAAC;AAAmB;AACxB,wBAAI,QAAQ,EAAC,WAAU,QAAO,CAAC;AAC/B,UAAI,WAAW,QAAQ,UAAU;AAEjC,UAAI,KAAK,SAAS,gBAAgB;AAAA,QAChC,OAAO,QAAQ;AAAA,QACf,QAAQ,QAAQ;AAAA,MAElB,CAAC;AAED,SAAG,SAAS,kCAAkC,CAAC,WAAgB;AAC7D,WAAG,MAAM;AACT,iBAAS,OAAO,KAAK,EAAE,YAAY;AACnC,YAAI,UAAU,OAAO,UAAU;AAAO,eAAK,MAAM;AAAA,aAC5C;AACH,eAAK;AAAA,QACP;AAAA,MACF,CAAC;AAAA,IAGH,CAAC;AACD,qBAAmB,WAAW,MAAI;AAChC,wBAAkB;AAClB,YAAQ,IAAI,mBAAmB;AAC/B,4BAAI,iCAAiC;AACrC,kCAAW;AACX,qCAAa;AACb,eAAW,MAAI;AAAC,WAAK,QAAQ;AAAA,IAAC,GAAG,GAAK;AAAA,EACxC,GAAG,IAAK;AACV,SAAS,GAAP;AACA,UAAQ,IAAI,CAAC;AACf;AAEA,eAAe,OACf;AACE,gCAAW;AACX,qCAAc;AACd,mCAAa;AACb,MAAI,MAAM,IAAI,KAAK,KAAK,IAAI,CAAC;AAC7B,eAAa,gDAA8C,IAAI,eAAe,SAAS,EAAC,UAAU,mBAAkB,CAAC,IAAE;AACvH,0BAAI,UAAU;AACd,oBAAI,QAAQ,EAAC,WAAU,QAAO,CAAC,EAAE,KAAK,CAAC,QAA8D;AACnG,YAAQ,IAAI,GAAG;AACf,aAAS,IAAE,GAAG,IAAE,IAAI,UAAU,QAAQ,KAAK;AACzC,yCAAe,QAAQ,IAAI,yBAAK,aAAa,IAAI,UAAU,EAAE,CAAC;AAC9D,UAAI,oBAAG,4BAA4B,IAAI,UAAU,KAAI,OAAO,iBAAiB,IAAI,UAAU,IAAI,EAAE,IAAI,UAAU,MAAI,UAAU,IAAI,UAAU,MAAI,OAAO;AACtJ,8BAAI,qBAAqB,IAAE,IAAI,UAAU;AACzC,cAAQ,IAAI,uBAAuB,IAAI,UAAU,EAAE;AAAA,IACrD;AAOA,aAAS,IAAE,GAAG,IAAE,IAAI,MAAM,QAAQ,KAAK;AACrC,UAAI,uBAAK,IAAI,MAAM,IAAI,KAAK;AAE5B,cAAQ,IAAI,uBAAuB,IAAI,MAAM,EAAE;AAAA,IACjD;AACA,aAAS,IAAE,GAAG,IAAE,IAAI,SAAS,QAAQ,KAAK;AACxC,UAAI,uBAAK,IAAI,SAAS,IAAI,IAAI;AAE9B,cAAQ,IAAI,8BAA8B,IAAI,SAAS,EAAE;AAAA,IAC3D;AAAA,EACF,CAAC;AACH;",
  "names": []
}

{
  "version": 3,
  "sources": ["../index.ts"],
  "sourcesContent": ["import {initServer} from './server';\nimport {DBMaintenance, connectDB, client} from './database';\nimport {supportHandler, Room} from './supportRooms'\nimport {log} from './logging';\nimport {uDB} from './consts';\nimport {WS} from './betautilities/wsHandler';\nimport {WebH} from './betautilities/webHandler';\nimport { serverUpdate } from './betautilities/wordler';\nexport let connectionSuccess = true;\nexport let DBConnectFailure:any = null;\nimport {authorize} from './mailer';\nconst { exec } = require(\"child_process\");\n\ntry {\n  authorize().then(()=>{\n    console.log(\"authorised\")\n  }).catch(console.error);\n\n  if (connectionSuccess)\n  connectDB().then((thing:any)=>{\n    console.log(thing)\n    if (!connectionSuccess) return;\n    initServer();\n    DBMaintenance();\n    serverUpdate();\n    log(\"Systems restarted\");\n    uDB.findOne({fieldName:\"ROOMS\"}).then((obj:{euphRooms:string[], rooms:string[], hidRooms:string[]})=>{\n      console.log(obj);\n      for (let i=0; i<obj.euphRooms.length; i++) {\n        supportHandler.addRoom(new Room(\"EUPH_ROOM\", obj.euphRooms[i]));\n        new WS(\"wss://euphoria.io/room/\" + obj.euphRooms[i] +\"/ws\", \"BetaUtilities\", obj.euphRooms[i], false)\n        log(\"Connected euph_room\")+obj.euphRooms[i];\n        console.log(\"Connected euph_room\", obj.euphRooms[i]);\n      }\n      for (let i=0; i<obj.rooms.length; i++) {\n        new WebH(obj.rooms[i], false);\n        //supportHandler.addRoom(new Room(\"ONLINE_SUPPORT\", obj.rooms[i]));\n        console.log(\"Loaded support room\", obj.rooms[i]);\n      }\n      for (let i=0; i<obj.hidRooms.length; i++) {\n        new WebH(obj.hidRooms[i], true);\n        // supportHandler.addRoom(new Room(\"HIDDEN_SUPPORT\", obj.hidRooms[i]));\n        console.log(\"Loaded hidden support room\", obj.hidRooms[i]);\n      }\n    })\n  });\n  DBConnectFailure = setTimeout(()=>{\n    connectionSuccess=false; \n    console.log(\"Connection failed\")\n    log(\"Services failed. Rebooting now.\")\n    initServer();\n    serverUpdate();\n    setTimeout(()=>{exec(\"kill 1\")}, 10000);\n  }, 29000);\n} catch (e:any) {\n  console.log(e);\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAyB;AACzB,sBAA+C;AAC/C,0BAAmC;AACnC,qBAAkB;AAClB,oBAAkB;AAClB,uBAAiB;AACjB,wBAAmB;AACnB,qBAA6B;AAG7B,oBAAwB;AAFjB,IAAI,oBAAoB;AACxB,IAAI,mBAAuB;AAElC,MAAM,EAAE,KAAK,IAAI,QAAQ,eAAe;AAExC,IAAI;AACF,+BAAU,EAAE,KAAK,MAAI;AACnB,YAAQ,IAAI,YAAY;AAAA,EAC1B,CAAC,EAAE,MAAM,QAAQ,KAAK;AAEtB,MAAI;AACJ,mCAAU,EAAE,KAAK,CAAC,UAAY;AAC5B,cAAQ,IAAI,KAAK;AACjB,UAAI,CAAC;AAAmB;AACxB,oCAAW;AACX,yCAAc;AACd,uCAAa;AACb,8BAAI,mBAAmB;AACvB,wBAAI,QAAQ,EAAC,WAAU,QAAO,CAAC,EAAE,KAAK,CAAC,QAA8D;AACnG,gBAAQ,IAAI,GAAG;AACf,iBAAS,IAAE,GAAG,IAAE,IAAI,UAAU,QAAQ,KAAK;AACzC,6CAAe,QAAQ,IAAI,yBAAK,aAAa,IAAI,UAAU,EAAE,CAAC;AAC9D,cAAI,oBAAG,4BAA4B,IAAI,UAAU,KAAI,OAAO,iBAAiB,IAAI,UAAU,IAAI,KAAK;AACpG,kCAAI,qBAAqB,IAAE,IAAI,UAAU;AACzC,kBAAQ,IAAI,uBAAuB,IAAI,UAAU,EAAE;AAAA,QACrD;AACA,iBAAS,IAAE,GAAG,IAAE,IAAI,MAAM,QAAQ,KAAK;AACrC,cAAI,uBAAK,IAAI,MAAM,IAAI,KAAK;AAE5B,kBAAQ,IAAI,uBAAuB,IAAI,MAAM,EAAE;AAAA,QACjD;AACA,iBAAS,IAAE,GAAG,IAAE,IAAI,SAAS,QAAQ,KAAK;AACxC,cAAI,uBAAK,IAAI,SAAS,IAAI,IAAI;AAE9B,kBAAQ,IAAI,8BAA8B,IAAI,SAAS,EAAE;AAAA,QAC3D;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AACD,qBAAmB,WAAW,MAAI;AAChC,wBAAkB;AAClB,YAAQ,IAAI,mBAAmB;AAC/B,4BAAI,iCAAiC;AACrC,kCAAW;AACX,qCAAa;AACb,eAAW,MAAI;AAAC,WAAK,QAAQ;AAAA,IAAC,GAAG,GAAK;AAAA,EACxC,GAAG,IAAK;AACV,SAAS,GAAP;AACA,UAAQ,IAAI,CAAC;AACf;",
  "names": []
}

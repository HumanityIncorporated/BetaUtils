{
  "version": 3,
  "sources": ["../delacc.ts"],
  "sourcesContent": ["import {authDB, userRegex} from './consts';\nconst argon2 = require('argon2');\n\nexport async function deleteAccount(user:string, pass:string, token:string) {\n  let tokenData:{associatedUser:string, expiry:number} = await authDB.findOne({fieldName:\"Token\", token:token});\n  if (!tokenData) {\n    return {status:\"ERROR\", data:{error:\"Cannot update user information: Your session could not be found!\"}, token:\"\"}\n  }\n  if (!user.match(userRegex)) {\n    return {status:\"ERROR\", data:{error:\"Invalid user string!\"}, token:token}\n  }\n  \n  let usrInfo = await authDB.findOne({fieldName:\"UserData\", user:{$eq:user}}) as {pwd:string, permLevel:number};\n  if (!usrInfo) {\n    return {status:\"ERROR\", data:{error:\"No such user!\"}, token:token};\n  }\n  let loginInfo:{permLevel:number}= await authDB.findOne({fieldName:\"UserData\", user:tokenData.associatedUser});\n  if (loginInfo.permLevel>usrInfo.permLevel) { // admin override\n    // delete all tokens from the deleted user\n    await authDB.deleteMany({fieldName:\"Token\", associatedUser:user})\n    await authDB.deleteOne({fieldName:\"UserData\", user:user});\n    return {status:\"SUCCESS\", data:null, token:token};\n  }\n  else return {status:\"ERROR\", data:{error:\"Cannot delete account -- insufficient permissions!\"}, token:token}\n  if (pass.length == 0) {\n    return {status:\"ERROR\", data:{error:\"No password provided!\"}, token:token}\n  }\n  else if (await argon2.verify(usrInfo.pwd, pass)) {\n    await authDB.deleteOne({fieldName:\"Token\", token:token})\n    await authDB.deleteOne({fieldName:\"UserData\", user:user});\n    return {status:\"SUCCESS\", data:null, token:\"\"};\n  } else {\n    return {status:\"ERROR\", data:{error:\"Cannot delete account. Password is invalid!\"}, token:token};\n  }\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAgC;AAChC,MAAM,SAAS,QAAQ,QAAQ;AAE/B,eAAsB,cAAc,MAAa,MAAa,OAAc;AAC1E,MAAI,YAAmD,MAAM,qBAAO,QAAQ,EAAC,WAAU,SAAS,MAAW,CAAC;AAC5G,MAAI,CAAC,WAAW;AACd,WAAO,EAAC,QAAO,SAAS,MAAK,EAAC,OAAM,mEAAkE,GAAG,OAAM,GAAE;AAAA,EACnH;AACA,MAAI,CAAC,KAAK,MAAM,uBAAS,GAAG;AAC1B,WAAO,EAAC,QAAO,SAAS,MAAK,EAAC,OAAM,uBAAsB,GAAG,MAAW;AAAA,EAC1E;AAEA,MAAI,UAAU,MAAM,qBAAO,QAAQ,EAAC,WAAU,YAAY,MAAK,EAAC,KAAI,KAAI,EAAC,CAAC;AAC1E,MAAI,CAAC,SAAS;AACZ,WAAO,EAAC,QAAO,SAAS,MAAK,EAAC,OAAM,gBAAe,GAAG,MAAW;AAAA,EACnE;AACA,MAAI,YAA8B,MAAM,qBAAO,QAAQ,EAAC,WAAU,YAAY,MAAK,UAAU,eAAc,CAAC;AAC5G,MAAI,UAAU,YAAU,QAAQ,WAAW;AAEzC,UAAM,qBAAO,WAAW,EAAC,WAAU,SAAS,gBAAe,KAAI,CAAC;AAChE,UAAM,qBAAO,UAAU,EAAC,WAAU,YAAY,KAAS,CAAC;AACxD,WAAO,EAAC,QAAO,WAAW,MAAK,MAAM,MAAW;AAAA,EAClD;AACK,WAAO,EAAC,QAAO,SAAS,MAAK,EAAC,OAAM,qDAAoD,GAAG,MAAW;AAC3G,MAAI,KAAK,UAAU,GAAG;AACpB,WAAO,EAAC,QAAO,SAAS,MAAK,EAAC,OAAM,wBAAuB,GAAG,MAAW;AAAA,EAC3E,WACS,MAAM,OAAO,OAAO,QAAQ,KAAK,IAAI,GAAG;AAC/C,UAAM,qBAAO,UAAU,EAAC,WAAU,SAAS,MAAW,CAAC;AACvD,UAAM,qBAAO,UAAU,EAAC,WAAU,YAAY,KAAS,CAAC;AACxD,WAAO,EAAC,QAAO,WAAW,MAAK,MAAM,OAAM,GAAE;AAAA,EAC/C,OAAO;AACL,WAAO,EAAC,QAAO,SAAS,MAAK,EAAC,OAAM,8CAA6C,GAAG,MAAW;AAAA,EACjG;AACF;",
  "names": []
}

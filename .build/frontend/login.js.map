{
  "version": 3,
  "sources": ["../../frontend/login.ts"],
  "sourcesContent": ["function onLoad() {\n  let match = document.cookie.match(\"__Secure-session=[0-9.]+\");\n  console.log(\"Current session: \"+match);\n  if (!match && document.URL.match(\"admin\")) {\n    alertDialog(\"You're not logged in!\", ()=>{window.open(\"/\", \"_self\");}); \n  }\n}\n\nfunction newUser(e:Event, accessclass:string) {\n  let id=(e.target as HTMLElement).id;\n  console.log(id);\n  if (id !=\"loginBTN\")\n    return;\n  validateLogin(\"add\", accessclass);\n}\nfunction validateLogin(action:string=\"login\", access:string) {\n  let user = document.getElementById(\"userINP\") as HTMLInputElement;\n  let pass = document.getElementById(\"passINP\") as HTMLInputElement;\n  \n  if ((action !=\"login\" && action !=\"add\") || (user.value.match(\"^[a-zA-Z0-9_]+$\") && pass.value.length!==0)) {\n    let arr = new BigUint64Array(1);\n    let match = document.cookie.match(\"__Secure-session=([0-9.]+)\");\n    let sessionID = match?match[1]:window.crypto.getRandomValues(arr);\n    // ONLY USE THE sessionID WHEN ADDING A NEW session\n    \n    console.log(match);\n    \n    // alert/(document.cookie);\n    let params;\n    if (action!=\"logout\") params= \"user=\"+user.value+\"&pass=\"+pass.value+\"&action=\"+action+\"&access=\"+access+\"&token=\"+sessionID;\n    else params=\"user=&pass=&action=logout&token=\"+sessionID;\n    if (pass) pass.value=\"\";\n    console.log(\"SENDING \"+params);\n    var xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", \"login\", true);\n    xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n    xhr.onreadystatechange = function(){\n      if(xhr.readyState == 4 && xhr.status == 200){\n        if (action==\"server\") return;\n        let res = xhr.responseText;\n        res = JSON.parse(res);\n        let ele = document.getElementById('overlay');\n        if (ele) ele.className = \"\";\n        ele = document.getElementById('h1');\n        if (ele) ele.className = \"beforeoverload\";\n        if (action != \"login\") {\n          if (res == \"ACCESS\") {\n            alertDialog(\"Error: You do not have permissions!\", ()=>{});\n          }\n          else if (res == \"EXPIRE\")\n            alertDialog(\"Error: Your login session has expired!\", ()=>{validateLogin(\"logout\", \"\")});\n          else if (res == \"NOACTIVE\") {\n            alertDialog(\"Error: You are not logged in!\", ()=>{window.open(\"/\", \"_self\")});\n          }\n          else if (action==\"logout\") {\n            // alert(\"Logging out\");\n            document.cookie = \"__Secure-session=; Secure;\";\n            alertDialog(\"You've been logged out\", ()=>{window.open(\"/\", \"_self\")});\n          }\n          else \n            alertDialog(\"Action complete!\", ()=>{});\n          return;\n        }\n        if (res == \"2\") {\n          alertDialog(\"Welcome, \"+user.value+\"! | Administrative access granted.\", ()=>{ window.open(\"/admin\", \"_self\");})\n          if (!match && action ==\"login\") document.cookie = \"__Secure-session=\"+sessionID+\"; SameSite=None; Secure\";\n        }\n        else if (res == \"1\") {\n          alertDialog(\"Welcome, \"+user.value+\"!\", ()=> {window.open(\"/\", \"_self\");});\n          if (!match && action ==\"login\") document.cookie = \"__Secure-session=\"+sessionID+\"; SameSite=None; Secure\";\n        }\n        else {\n          alertDialog(\"Error: Invalid login credentials\", ()=>{window.open(\"/login\", \"_self\");});\n          \n        }\n      }\n    }\n    xhr.send(params as string);\n    let ele = document.getElementById('overlay');\n    if (ele) ele.className += \"active\";\n    ele = document.getElementById('h1');\n    if (ele) ele.className =\"overload\";\n  } //else {\n  //   alertDialog(\"Invalid credentials!\");\n  // }\n}\n\nfunction logout() {\n  // document.cookie = \"__Secure-session=\";\n  // console.log(\"Cookie should be removed.\")\n  validateLogin(\"logout\",\"\");\n}\n\nlet dialog = false;\nlet cbk;\n\nfunction alertDialog(txt:string, callback:()=>any) {\n  let div = document.getElementById(\"alert\") as HTMLDivElement;\n  div.style.animationName = \"incoming\";\n  div.style.top = \"0px\";\n  let ele = document.getElementById(\"alerttxt\") as HTMLParagraphElement;\n  ele.innerHTML = txt;\n  dialog = true;\n  cbk = callback;\n}\n\nfunction clearalert() {\n  if (dialog && cbk) {\n    let div = document.getElementById(\"alert\") as HTMLDivElement;\n    div.style.animationName = \"outgoing\";\n    div.style.top = \"100vh\";\n    dialog = false;\n    cbk()\n    cbk = null;\n  }\n}"],
  "mappings": "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",
  "names": ["ele"]
}

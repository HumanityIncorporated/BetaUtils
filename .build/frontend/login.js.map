{
  "version": 3,
  "sources": ["../../frontend/login.ts"],
  "sourcesContent": ["function onLoad() {\n  let match = document.cookie.match(\"__Secure-session=[0-9.]+\");\n  console.log(\"Current session: \" + match);\n  if (!match && document.URL.match(\"admin\")) {\n    alertDialog(\"You're not logged in!\", () => { window.open(\"/signup\", \"_self\"); });\n  }\n  document.getElementById(\"alert\").hidden=true;\n  document.getElementById(\"h1\").hidden=true;\n}\n\nfunction newUser(e: Event, accessclass: string) {\n  let id = (e.target as HTMLElement).id;\n  console.log(id);\n  if (id != \"loginBTN\")\n    return;\n  validateLogin(\"add\", accessclass);\n}\n\nfunction sendMsg() {\n  let inp = document.getElementById(\"textINP\") as HTMLInputElement;\n  let msg = inp.value;\n  inp.value = \"\";\n  validateLogin(\"sendMsg\", msg);\n}\n\nfunction validateLogin(action: string = \"login\", extData: string) {\n  let user = document.getElementById(\"userINP\") as HTMLInputElement;\n  let pass = document.getElementById(\"passINP\") as HTMLInputElement;\n  let confirm = document.getElementById(\"passINPCONF\") as HTMLInputElement;\n  // console.log(confirm.value);\n  let CMD = document.getElementById(\"command\") as HTMLInputElement;\n\n\n\n  if ((action != \"login\" && action != \"add\" && action != \"signup\") || (user.value.match(\"^[a-zA-Z0-9_]+$\") && pass.value.length !== 0)) {\n    if (confirm && (action == \"add\" || action == \"signup\") && confirm.value != pass.value) {\n      console.log(\"Nomatch\");\n      alertDialog(\"Error: Your passwords do not match\", () => { location.reload(); });\n      return;\n    }\n    if (confirm) confirm.value = \"\";\n    let arr = new BigUint64Array(1);\n    let match = document.cookie.match(\"__Secure-session=([0-9.]+)\");\n    let sessionID = match ? match[1] : window.crypto.getRandomValues(arr);\n    // ONLY USE THE sessionID WHEN ADDING A NEW session\n\n\n    // alert/(document.cookie);\n    let params;\n    if (action != \"logout\" && action != \"CMD\" && action != \"sendMsg\") params = \"user=\" + encodeURIComponent(user?user.value:\"\") + \"&pass=\" + encodeURIComponent(pass?pass.value:\"\") + \"&action=\" + action + \"&access=\" + extData + \"&token=\" + sessionID;\n    else if (action == \"CMD\") {\n      params = \"user=\" + encodeURIComponent(CMD.value) + \"&action=CMD&token=\" + sessionID;\n      CMD.value = \"\";\n    }\n    else if (action == \"sendMsg\") {\n      params = \"token=\" + sessionID + \"&action=sendMsg&user=\" + encodeURIComponent(extData);\n    }\n    else params = \"user=&pass=&action=logout&token=\" + sessionID;\n    if (pass) pass.value = \"\";\n    if (action != \"refresh\" && action != \"refresh_log\") console.log(\"SENDING \" + params);\n    var xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", \"login\", true);\n    xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState == 4 && xhr.status == 200) {\n        if (action == \"server\") return;\n        let res = xhr.responseText;\n        res = JSON.parse(res);\n        let ele = document.getElementById('overlay');\n        if (ele) ele.className = \"\";\n        ele = document.getElementById('h1');\n        if (ele) ele.className = \"beforeoverload\";\n        if (action != \"login\") {\n          if (action == \"sendMsg\") {\n            validateLogin(\"refresh\", \"\");\n            return;\n          }\n          if (action == \"refresh\" || action== \"refresh_log\") {\n            if (res == \"ACCESS\" || res == \"EXPIRE\" || res == \"NOACTIVE\" || res == \"ERROR\") {\n              location.reload();\n            }\n            updateTextArea(res);\n            return;\n          }\n          if (res == \"ACCESS\") {\n            alertDialog(\"Error: You do not have permissions!\", () => { });\n          }\n          else if (res == \"EXPIRE\")\n            alertDialog(\"Error: Your login session has expired!\", () => { validateLogin(\"logout\", \"\") });\n          else if (res == \"NOACTIVE\") {\n            alertDialog(\"Error: You are not logged in!\", () => { window.open(\"/\", \"_self\") });\n          }\n          else if (action == \"logout\") {\n            // alert(\"Logging out\");\n            document.cookie = \"__Secure-session=; Secure;\";\n            alertDialog(\"You've been logged out\", () => { window.open(\"/\", \"_self\") });\n          }\n          else if (res == \"ERROR\") {\n            alertDialog(\"Unknown error!\", () => { });\n          }\n          else if (res == \"TAKEN\") {\n            alertDialog(\"This username is already taken!\", () => { });\n          }\n          else {\n            alertDialog(\"Action complete!\", () => { if (action == \"signup\") window.open(\"/\", \"_self\") });\n            if (!match && action == \"signup\") document.cookie = \"__Secure-session=\" + sessionID + \"; SameSite=None; Secure\";\n          }\n          return;\n        } // not login\n        if (res == \"2\") {\n          alertDialog(\"Welcome, \" + user.value + \"! | Administrative access granted.\", () => { window.open(\"/admin\", \"_self\"); })\n          if (!match && action == \"login\") document.cookie = \"__Secure-session=\" + sessionID + \"; SameSite=None; Secure\";\n        }\n        else if (res == \"3\") {\n          alertDialog(\"Welcome, betatester1024.\", () => { window.open(\"/admin\", \"_self\") });\n          if (!match && action == \"login\") document.cookie = \"__Secure-session=\" + sessionID + \"; SameSite=None; Secure\";\n        }\n        else if (res == \"1\") {\n          alertDialog(\"Welcome, \" + user.value + \"!\", () => { window.open(\"/\", \"_self\"); });\n          if (!match && action == \"login\") document.cookie = \"__Secure-session=\" + sessionID + \"; SameSite=None; Secure\";\n        }\n        else {\n          alertDialog(\"Error: Invalid login credentials\", () => { window.open(\"/login\", \"_self\"); });\n        }\n      }\n    }\n    xhr.send(params);\n    if (action != 'sendMsg' && action != \"refresh\" && action != \"refreshLog\") {\n      let ele = document.getElementById('overlay');\n      if (ele) ele.className += \"active\";\n      ele = document.getElementById('h1');\n      ele.hidden=false;\n      if (ele) ele.className = \"overload\";\n    }\n  } else if (!(user.value.match(\"^[a-zA-Z0-9_]+$\"))) {\n    alertDialog(\"Please enter a username with only alphanumeric characters, or underscores.\", () => { });\n  } else if (pass.value.length == 0) {\n    alertDialog(\"Please enter a password.\", () => { })\n  }\n}\n\nfunction logout() {\n  // document.cookie = \"__Secure-session=\";\n  // console.log(\"Cookie should be removed.\")\n  validateLogin(\"logout\", \"\");\n}\n\nlet dialog = false;\nlet cbk: ()=>any;\n\nfunction alertDialog(txt: string, callback: () => any) {\n  let div = document.getElementById(\"alert\") as HTMLDivElement;\n  div.style.animationName = \"incoming\";\n  div.style.top = \"0px\";\n  let ele = document.getElementById(\"alerttxt\") as HTMLParagraphElement;\n  ele.innerHTML = txt;\n  dialog = true;\n  cbk = callback;\n  div.hidden=false;\n  // console.log(\"ALERT\");\n}\n\nfunction clearalert() {\n  if (dialog && cbk) {\n    let div = document.getElementById(\"alert\") as HTMLDivElement;\n    div.style.animationName = \"outgoing\";\n    div.style.top = \"100vh\";\n    dialog = false;\n    cbk()\n    cbk = null;\n    alert.hidden=true;\n  }\n}\n\nfunction updateTextArea(msgs:string) {\n  let ele = document.getElementById(\"msgArea\") as HTMLDivElement;\n  ele.innerHTML = msgs;\n  ele.scrollTop = ele.scrollHeight;\n  \n}"],
  "mappings": ";AAAA,SAAS,SAAS;AAChB,MAAI,QAAQ,SAAS,OAAO,MAAM,0BAA0B;AAC5D,UAAQ,IAAI,sBAAsB,KAAK;AACvC,MAAI,CAAC,SAAS,SAAS,IAAI,MAAM,OAAO,GAAG;AACzC,gBAAY,yBAAyB,MAAM;AAAE,aAAO,KAAK,WAAW,OAAO;AAAA,IAAG,CAAC;AAAA,EACjF;AACA,WAAS,eAAe,OAAO,EAAE,SAAO;AACxC,WAAS,eAAe,IAAI,EAAE,SAAO;AACvC;AAEA,SAAS,QAAQ,GAAU,aAAqB;AAC9C,MAAI,KAAM,EAAE,OAAuB;AACnC,UAAQ,IAAI,EAAE;AACd,MAAI,MAAM;AACR;AACF,gBAAc,OAAO,WAAW;AAClC;AAEA,SAAS,UAAU;AACjB,MAAI,MAAM,SAAS,eAAe,SAAS;AAC3C,MAAI,MAAM,IAAI;AACd,MAAI,QAAQ;AACZ,gBAAc,WAAW,GAAG;AAC9B;AAEA,SAAS,cAAc,SAAiB,SAAS,SAAiB;AAChE,MAAI,OAAO,SAAS,eAAe,SAAS;AAC5C,MAAI,OAAO,SAAS,eAAe,SAAS;AAC5C,MAAI,UAAU,SAAS,eAAe,aAAa;AAEnD,MAAI,MAAM,SAAS,eAAe,SAAS;AAI3C,MAAK,UAAU,WAAW,UAAU,SAAS,UAAU,YAAc,KAAK,MAAM,MAAM,iBAAiB,KAAK,KAAK,MAAM,WAAW,GAAI;AACpI,QAAI,YAAY,UAAU,SAAS,UAAU,aAAa,QAAQ,SAAS,KAAK,OAAO;AACrF,cAAQ,IAAI,SAAS;AACrB,kBAAY,sCAAsC,MAAM;AAAE,iBAAS,OAAO;AAAA,MAAG,CAAC;AAC9E;AAAA,IACF;AACA,QAAI;AAAS,cAAQ,QAAQ;AAC7B,QAAI,MAAM,IAAI,eAAe,CAAC;AAC9B,QAAI,QAAQ,SAAS,OAAO,MAAM,4BAA4B;AAC9D,QAAI,YAAY,QAAQ,MAAM,KAAK,OAAO,OAAO,gBAAgB,GAAG;AAKpE,QAAI;AACJ,QAAI,UAAU,YAAY,UAAU,SAAS,UAAU;AAAW,eAAS,UAAU,mBAAmB,OAAK,KAAK,QAAM,EAAE,IAAI,WAAW,mBAAmB,OAAK,KAAK,QAAM,EAAE,IAAI,aAAa,SAAS,aAAa,UAAU,YAAY;AAAA,aAClO,UAAU,OAAO;AACxB,eAAS,UAAU,mBAAmB,IAAI,KAAK,IAAI,uBAAuB;AAC1E,UAAI,QAAQ;AAAA,IACd,WACS,UAAU,WAAW;AAC5B,eAAS,WAAW,YAAY,0BAA0B,mBAAmB,OAAO;AAAA,IACtF;AACK,eAAS,qCAAqC;AACnD,QAAI;AAAM,WAAK,QAAQ;AACvB,QAAI,UAAU,aAAa,UAAU;AAAe,cAAQ,IAAI,aAAa,MAAM;AACnF,QAAI,MAAM,IAAI,eAAe;AAC7B,QAAI,KAAK,QAAQ,SAAS,IAAI;AAC9B,QAAI,iBAAiB,gBAAgB,mCAAmC;AACxE,QAAI,qBAAqB,WAAW;AAClC,UAAI,IAAI,cAAc,KAAK,IAAI,UAAU,KAAK;AAC5C,YAAI,UAAU;AAAU;AACxB,YAAI,MAAM,IAAI;AACd,cAAM,KAAK,MAAM,GAAG;AACpB,YAAI,MAAM,SAAS,eAAe,SAAS;AAC3C,YAAI;AAAK,cAAI,YAAY;AACzB,cAAM,SAAS,eAAe,IAAI;AAClC,YAAI;AAAK,cAAI,YAAY;AACzB,YAAI,UAAU,SAAS;AACrB,cAAI,UAAU,WAAW;AACvB,0BAAc,WAAW,EAAE;AAC3B;AAAA,UACF;AACA,cAAI,UAAU,aAAa,UAAS,eAAe;AACjD,gBAAI,OAAO,YAAY,OAAO,YAAY,OAAO,cAAc,OAAO,SAAS;AAC7E,uBAAS,OAAO;AAAA,YAClB;AACA,2BAAe,GAAG;AAClB;AAAA,UACF;AACA,cAAI,OAAO,UAAU;AACnB,wBAAY,uCAAuC,MAAM;AAAA,YAAE,CAAC;AAAA,UAC9D,WACS,OAAO;AACd,wBAAY,0CAA0C,MAAM;AAAE,4BAAc,UAAU,EAAE;AAAA,YAAE,CAAC;AAAA,mBACpF,OAAO,YAAY;AAC1B,wBAAY,iCAAiC,MAAM;AAAE,qBAAO,KAAK,KAAK,OAAO;AAAA,YAAE,CAAC;AAAA,UAClF,WACS,UAAU,UAAU;AAE3B,qBAAS,SAAS;AAClB,wBAAY,0BAA0B,MAAM;AAAE,qBAAO,KAAK,KAAK,OAAO;AAAA,YAAE,CAAC;AAAA,UAC3E,WACS,OAAO,SAAS;AACvB,wBAAY,kBAAkB,MAAM;AAAA,YAAE,CAAC;AAAA,UACzC,WACS,OAAO,SAAS;AACvB,wBAAY,mCAAmC,MAAM;AAAA,YAAE,CAAC;AAAA,UAC1D,OACK;AACH,wBAAY,oBAAoB,MAAM;AAAE,kBAAI,UAAU;AAAU,uBAAO,KAAK,KAAK,OAAO;AAAA,YAAE,CAAC;AAC3F,gBAAI,CAAC,SAAS,UAAU;AAAU,uBAAS,SAAS,sBAAsB,YAAY;AAAA,UACxF;AACA;AAAA,QACF;AACA,YAAI,OAAO,KAAK;AACd,sBAAY,cAAc,KAAK,QAAQ,sCAAsC,MAAM;AAAE,mBAAO,KAAK,UAAU,OAAO;AAAA,UAAG,CAAC;AACtH,cAAI,CAAC,SAAS,UAAU;AAAS,qBAAS,SAAS,sBAAsB,YAAY;AAAA,QACvF,WACS,OAAO,KAAK;AACnB,sBAAY,4BAA4B,MAAM;AAAE,mBAAO,KAAK,UAAU,OAAO;AAAA,UAAE,CAAC;AAChF,cAAI,CAAC,SAAS,UAAU;AAAS,qBAAS,SAAS,sBAAsB,YAAY;AAAA,QACvF,WACS,OAAO,KAAK;AACnB,sBAAY,cAAc,KAAK,QAAQ,KAAK,MAAM;AAAE,mBAAO,KAAK,KAAK,OAAO;AAAA,UAAG,CAAC;AAChF,cAAI,CAAC,SAAS,UAAU;AAAS,qBAAS,SAAS,sBAAsB,YAAY;AAAA,QACvF,OACK;AACH,sBAAY,oCAAoC,MAAM;AAAE,mBAAO,KAAK,UAAU,OAAO;AAAA,UAAG,CAAC;AAAA,QAC3F;AAAA,MACF;AAAA,IACF;AACA,QAAI,KAAK,MAAM;AACf,QAAI,UAAU,aAAa,UAAU,aAAa,UAAU,cAAc;AACxE,UAAI,MAAM,SAAS,eAAe,SAAS;AAC3C,UAAI;AAAK,YAAI,aAAa;AAC1B,YAAM,SAAS,eAAe,IAAI;AAClC,UAAI,SAAO;AACX,UAAI;AAAK,YAAI,YAAY;AAAA,IAC3B;AAAA,EACF,WAAW,CAAE,KAAK,MAAM,MAAM,iBAAiB,GAAI;AACjD,gBAAY,8EAA8E,MAAM;AAAA,IAAE,CAAC;AAAA,EACrG,WAAW,KAAK,MAAM,UAAU,GAAG;AACjC,gBAAY,4BAA4B,MAAM;AAAA,IAAE,CAAC;AAAA,EACnD;AACF;AAEA,SAAS,SAAS;AAGhB,gBAAc,UAAU,EAAE;AAC5B;AAEA,IAAI,SAAS;AACb,IAAI;AAEJ,SAAS,YAAY,KAAa,UAAqB;AACrD,MAAI,MAAM,SAAS,eAAe,OAAO;AACzC,MAAI,MAAM,gBAAgB;AAC1B,MAAI,MAAM,MAAM;AAChB,MAAI,MAAM,SAAS,eAAe,UAAU;AAC5C,MAAI,YAAY;AAChB,WAAS;AACT,QAAM;AACN,MAAI,SAAO;AAEb;AAEA,SAAS,aAAa;AACpB,MAAI,UAAU,KAAK;AACjB,QAAI,MAAM,SAAS,eAAe,OAAO;AACzC,QAAI,MAAM,gBAAgB;AAC1B,QAAI,MAAM,MAAM;AAChB,aAAS;AACT,QAAI;AACJ,UAAM;AACN,UAAM,SAAO;AAAA,EACf;AACF;AAEA,SAAS,eAAe,MAAa;AACnC,MAAI,MAAM,SAAS,eAAe,SAAS;AAC3C,MAAI,YAAY;AAChB,MAAI,YAAY,IAAI;AAEtB;",
  "names": []
}

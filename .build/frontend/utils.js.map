{
  "version": 3,
  "sources": ["../../frontend/utils.ts"],
  "sourcesContent": ["function globalOnload(cbk:()=>any) {\n  document.onkeydown = keydown;\n  send(JSON.stringify({ action: \"userRequest\" }),\n    (res) => {\n      document.documentElement.className = res.data.darkQ?\"dark\":\"\";\n      let maincontent = document.getElementsByClassName(\"main_content\").item(0) as HTMLDivElement;\n      let ftr = document.createElement(\"footer\");\n      maincontent.appendChild(ftr);\n      let ele = document.createElement(\"p\");\n      ele.id=\"footer\";\n      if (res.status != \"SUCCESS\")\n        ele.innerHTML = `<a href='/login'>Login</a> | \n                      <a href='/signup'>Sign-up</a> | \n                      <a href='/status'>Status</a> | \n                      BetaOS Systems V2, 2023`;\n      else {\n        ele.innerHTML = `Logged in as <kbd>${res.data.user}</kbd> |\n                      <a href='/logout'>Logout</a> | \n                      <a href='/config'>Account</a> | \n                      <a href='/status'>Status</a> | \n                      <a href='javascript:send(JSON.stringify({action:\"toggleTheme\"}), (res)=>{if (res.status != \"SUCCESS\") alertDialog(\"Error: \"+res.data.error, ()=>{});else {alertDialog(\"Theme updated!\", ()=>{location.reload()}); }})'>Theme</a> |\n                      BetaOS Systems V2, 2023`;\n      }\n      ftr.appendChild(ele);\n      send(JSON.stringify({ action: \"visits\" }),\n        (res) => {\n          overlay.style.backgroundColor=\"var(--system-grey2)\";\n          if (res.status != \"SUCCESS\") {\n            alertDialog(\"Database connection failure. Please contact BetaOS.\", ()=>{});\n            ele.innerHTML = `<kbd class=\"red nohover\">Database connection failure.</kbd>`\n          }// this means the database died \n          document.getElementById(\"footer\").innerHTML += \" | <kbd>\"+res.data.data+\"</kbd>\";\n          send(JSON.stringify({action:\"cookieRequest\"}), (res)=>{\n            if (res.data.toString() == \"false\") {\n              console.log(\"thing\");\n              document.getElementById(\"compliance\").style.bottom=\"0px\";\n              \n              // document.getElementById(\"compliance\").style.top=\"unset\";\n            }\n            if (cbk) cbk();\n          })\n        }\n      )\n      \n    }, true);\n\n  document.body.innerHTML += `\n  <div id=\"compliance\">\n    <h2 class=\"blu nohover\">BetaOS Services uses cookies to operate.</h2>\n    <p>We use only <kbd>strictly necessary cookies</kbd> to verify and persist \n    your login session, and to confirm your acceptance of these cookies. <br>\n    By continuing to use this site, you consent to our use of these cookies.</p>\n    <button class='blu btn fsmed' onclick=\"acceptCookies()\">\n    <span class=\"material-symbols-outlined\">check</span>\n    I understand\n    <div class=\"anim\"></div>\n    </button>\n  </div>`\n  let ele2 = document.getElementById(\"overlay\");\n  if (ele2)\n    ele2.innerHTML = `\n  <div class=\"internal\">\n        <p class=\"fsmed\" id=\"alerttext\">Error: AlertDialog configured incorrectly. Please contact BetaOS.</p>\n        <button class=\"btn szHalf override\" onclick=\"closeAlert()\" style=\"display: inline-block\">\n          <span class=\"alertlbl\">Continue</span>\n          <span class=\"material-symbols-outlined\">arrow_forward_ios</span>\n          <div class=\"anim\"></div>\n        </button>\n        <button class=\"btn szHalf red override\" id=\"cancelBtn\" style=\"display: none\" onclick=\"closeAlert(true)\">\n          <span class=\"alertlbl\">Cancel</span>\n          <span class=\"material-symbols-outlined\">cancel</span>\n          <div class=\"anim\"></div>\n        </button>\n      </div>`;\n  else console.log(\"Alert dialogs disabled on this page\");\n  // update the alert-dialogs to allow cancel buttons\n  // cookie dialog also goes here\n}\n\nfunction send(params: any, callback: (thing: any) => any, onLoadQ:boolean=false) {\n  let overlay = document.getElementById(\"overlayL\");\n  if (overlay && !onLoadQ) {\n    // overlay.style.left=\"0vh\";\n    overlay.style.opacity=\"1\";\n    \n  }\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"POST\", \"server\", true);\n  xhr.setRequestHeader(\"Content-type\", \"application/json; charset=utf-8\");\n  xhr.onreadystatechange = () => {\n    if (xhr.readyState == 4 && xhr.status == 200) {\n      if (overlay) {\n        // overlay.style.left=\"200vh\";\n        overlay.style.opacity=\"0\";\n        // TIME = setTimeout(()=>{overlay.style.display=\"block\"}, 600);\n      }\n      if (failureTimeout) clearTimeout(failureTimeout);\n      else closeAlert(true);\n      failureTimeout = null;\n      callback(JSON.parse(xhr.responseText));\n    }\n  }\n  console.log(params);\n  xhr.send(params);\n  if (failureTimeout) clearTimeout(failureTimeout);\n  failureTimeout = setTimeout(() => alertDialog(`This is taking longer than expected.`, () => { }, 1, params), 1000);\n}\n\nfunction acceptCookies() {\n  send(JSON.stringify({action:\"acceptCookies\"}), (res)=> {\n    \n  });\n  document.getElementById(\"compliance\").style.bottom=\"-200vh\";\n}\n\nlet failureTimeout: NodeJS.Timeout | null;\nlet TIME:NodeJS.Timeout|null;\nlet dialogQ = false;\nlet cbk: () => any = () => { };\nlet BLOCKCALLBACK = false;\nfunction alertDialog(str: string, callback: () => any, button: number = -1, failedReq: string = \"\") {\n  if (TIME) clearTimeout(TIME);\n  TIME = null;\n  console.log(\"Timeout cleared\")\n  let overlay = document.getElementById(\"overlayL\");\n  if (overlay) {\n    overlay.style.left=\"200vh\";\n    overlay.style.opacity=\"0\";\n  }\n  let ele = document.getElementById(\"overlay\") as HTMLDivElement;\n  let p = document.getElementById(\"alerttext\") as HTMLParagraphElement;\n  if (!ele || !p) {\n    console.log(\"ERROR: Alert dialogs not enabled in this page.\")\n    callback();\n    return;\n  }\n  ele.style.top = \"0vh\";\n  dialogQ = true;\n  cbk = callback;\n  p.innerText = str;\n  document.getElementById(\"cancelBtn\").style.display = \"none\";\n  if (button == 1) {\n    p.innerHTML += `<button class='btn szThird fssml' id=\"refresh\" onclick='location.reload()'>\n    <span class=\"material-symbols-outlined\">history</span> Refresh?\n    <div class=\"anim\"></div></button>`\n    console.log(\"Failed request: \" + failedReq);\n    BLOCKCALLBACK = true;\n  }\n  else if (button == 2) {\n    document.getElementById(\"cancelBtn\").style.display = \"inline-block\";\n    console.log(\"Confirm speedbump\");\n    BLOCKCALLBACK = true;\n  }\n  if (failureTimeout) clearTimeout(failureTimeout);\n  failureTimeout = null;\n}\n\nfunction closeAlert(overrideCallback: boolean = false) {\n  let ele = document.getElementById(\"overlay\") as HTMLDivElement;\n  if (!ele) {\n    console.log(\"Alert dialogs not enabled in this page\");\n    return;\n  }\n  ele.style.top = \"200vh\";\n  dialogQ = false;\n  if (cbk && !overrideCallback) {\n    console.log(\"calling back\")\n    cbk();\n  }\n  BLOCKCALLBACK = false;\n}\n\nfunction keydown(e: Event) {\n  if (dialogQ) {\n    e.preventDefault();\n    if (BLOCKCALLBACK) closeAlert(true);\n    else {\n      console.log(\"KEYDOWNCLOSEDIALOG\")\n      closeAlert();\n    }\n  }\n}\n\nfunction toTime(ms: number) {\n  let day = Math.floor(ms / 1000 / 60 / 60 / 24);\n  ms = ms % (1000 * 60 * 60 * 24);\n  let hr = Math.floor(ms / 1000 / 60 / 60);\n  ms = ms % (1000 * 60 * 60);\n  let min = Math.floor(ms / 1000 / 60);\n  ms = ms % (1000 * 60);\n  let sec = Math.floor(ms / 1000);\n  if (ms < 0) return \"00:00:00\";\n  return (day > 0 ? day + \"d \" : \"\") + padWithZero(hr) + \":\" + padWithZero(min) + \":\" + padWithZero(sec);\n}\n\nfunction padWithZero(n: number) {\n  return n < 10 ? \"0\" + n : n;\n}\n\nlet overlay:HTMLDivElement;\naddEventListener(\"DOMContentLoaded\", function() {\n  overlay = document.createElement(\"div\");\n  overlay.className = \"overlayLoader\"\n  overlay.id = \"overlayL\";\n  overlay.style.left=\"0vh\";\n  overlay.style.backgroundColor=\"var(--system-bg)\";\n  overlay.style.opacity=\"1\";\n  overlay.innerHTML = `<span class=\"material-symbols-outlined loader\">sync</span>\n  <p class=\"loadp fslg grn nohover\">Loading.</p>`\n  // document.appendChild(document.createElement(\"body\"));\n  document.body.appendChild(overlay);\n    // Your code goes here\n});\n"],
  "mappings": "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",
  "names": ["cbk", "res", "overlay"]
}

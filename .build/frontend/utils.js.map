{
  "version": 3,
  "sources": ["../../frontend/utils.ts"],
  "sourcesContent": ["import dialogPolyfill from 'dialog-polyfill';\nfunction globalOnload(cbk:()=>any) {\n  document.onkeydown = keydown;\n  \n  document.body.addEventListener(\"mouseover\", mouseOver);\n  send(JSON.stringify({ action: \"userRequest\" }),\n    (res) => {\n      document.documentElement.className = res.data.darkQ?\"dark\":\"\";\n      console.log(\"Loading complete; updating class\")\n      // let overlay = document.getElementById(\"overlayL\");\n      // if (overlay) {\n      //   // overlay.style.left=\"0vh\";\n      //   overlay.style.opacity=\"0\";\n      // }\n      let maincontent = document.getElementsByClassName(\"main_content\").item(0) as HTMLDivElement;\n      let ftr = document.createElement(\"footer\");\n      maincontent.appendChild(ftr);\n      let ele = document.createElement(\"p\");\n      ele.id=\"footer\";\n      if (res.status != \"SUCCESS\")\n        ele.innerHTML = `<a href='/login'>Login</a> | \n                      <a href='/signup'>Sign-up</a> | \n                      <a href='/status'>Status</a> | \n                      BetaOS Systems V2, 2023`;\n      else {\n        ele.innerHTML = `Logged in as <kbd>${res.data.user}</kbd> |\n                      <a href='/logout'>Logout</a> | \n                      <a href='/config'>Account</a> | \n                      <a href='/status'>Status</a> | \n                      <a href='javascript:send(JSON.stringify({action:\"toggleTheme\"}), (res)=>{if (res.status != \"SUCCESS\") alertDialog(\"Error: \"+res.data.error, ()=>{});else {alertDialog(\"Theme updated!\", ()=>{location.reload()}); }})'>Theme</a> |\n                      BetaOS Systems V2, 2023`;\n      }\n      ftr.appendChild(ele);\n      send(JSON.stringify({ action: \"visits\" }),\n        (res) => {\n          \n          if (res.status != \"SUCCESS\") {\n            alertDialog(\"Database connection failure. Please contact BetaOS.\", ()=>{});\n            ele.innerHTML = `<kbd class=\"red nohover\">Database connection failure.</kbd>`\n          }// this means the database died \n          document.getElementById(\"footer\").innerHTML += \" | <kbd>\"+res.data.data+\"</kbd>\";\n          send(JSON.stringify({action:\"cookieRequest\"}), (res)=>{\n            if (res.data.toString() == \"false\") {\n              console.log(\"thing\");\n              document.getElementById(\"compliance\").style.bottom=\"0px\";\n              \n              // document.getElementById(\"compliance\").style.top=\"unset\";\n            }\n            if (cbk) cbk();\n          }, true);\n        }, true);\n      \n    }, true);\n\n  \n  let ele2 = document.getElementById(\"overlay\");\n  if (ele2)\n  //   ele2.innerHTML = \n    // document.getElementById(\"internal_alerts\").addEventListener(\"click\", ()=>{});\n  document.body.innerHTML += `\n  <div class=\"internal\" id=\"internal_alerts\" onclick=\"if (dialogQ) closeAlert(false, false)\" style=\"opacity: 0; text-align: center !important\">\n        <p class=\"fsmed\" id=\"alerttext_v2\">Error: AlertDialog configured incorrectly. Please contact BetaOS.</p>\n        <div style=\"text-align: center;\"><button class=\"btn szHalf override\" onclick=\"closeAlert()\" style=\"display: inline-block\">\n          <span class=\"alertlbl\">Continue</span>\n          <span class=\"material-symbols-outlined\">arrow_forward_ios</span>\n          <div class=\"anim\"></div>\n        </button>\n        <button class=\"btn szHalf red override\" id=\"cancelBtn\" style=\"display: none\" onclick=\"closeAlert(true)\">\n          <span class=\"alertlbl\">Cancel</span>\n          <span class=\"material-symbols-outlined\">cancel</span>\n          <div class=\"anim\"></div>\n        </button></div>\n      </div>`;\n  \n  else console.log(\"Alert dialogs disabled on this page\");\n  \n  let ele = document.getElementById(\"\");\n  document.body.innerHTML += `\n  <div id=\"compliance\">\n    <h2 class=\"blu nohover\">BetaOS Services uses cookies to operate.</h2>\n    <p>We use only <kbd>strictly necessary cookies</kbd> to verify and persist \n    your login session, and to confirm your acceptance of these cookies. <br>\n    By continuing to use this site, you consent to our use of these cookies.</p>\n    <button class='blu btn fsmed' onclick=\"acceptCookies()\">\n    <span class=\"material-symbols-outlined\">check</span>\n    I understand\n    <div class=\"anim\"></div>\n    </button>\n  </div>`\n  // update the alert-dialogs to allow cancel buttons\n  // cookie dialog also goes here\n}\n\nfunction send(params: any, callback: (thing: any) => any, onLoadQ:boolean=false) {\n  let overlay = document.getElementById(\"overlayL\");\n  console.log(onLoadQ)\n  if (overlay && !onLoadQ) {\n    console.log(\"content-blocking loader overlay enabled\")\n    overlay.style.opacity=\"1\";\n    overlay.style.backgroundColor=\"var(--system-overlay)\";\n  }\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"POST\", \"/server\", true);\n  xhr.setRequestHeader(\"Content-type\", \"application/json; charset=utf-8\");\n  xhr.onreadystatechange = () => {\n    if (xhr.readyState == 4 && xhr.status == 200) {\n      if (overlay) {\n        overlay.style.opacity=\"0\";\n        overlay.style.backgroundColor=\"var(--system-grey2)\";\n      }\n      if (failureTimeout) clearTimeout(failureTimeout);\n      else closeAlert(true);\n      failureTimeout = null;\n      callback(JSON.parse(xhr.responseText));\n    }\n  }\n  console.log(params);\n  xhr.send(params);\n  if (failureTimeout) clearTimeout(failureTimeout);\n  failureTimeout = setTimeout(() => alertDialog(`This is taking longer than expected.`, () => { }, 1, params), 5000);\n}\n\nfunction acceptCookies() {\n  send(JSON.stringify({action:\"acceptCookies\"}), (res)=> {});\n  document.getElementById(\"compliance\").style.bottom=\"-200vh\";\n}\n\nlet failureTimeout: NodeJS.Timeout | null;\n// let TIME:NodeJS.Timeout|null;\nlet dialogQ = false;\nlet cbk: () => any = () => { };\nlet BLOCKCALLBACK = false;\nfunction alertDialog(str: string, callback: () => any = ()=>{}, button: number = -1, failedReq: string = \"\") {\n  // if (TIME) clearTimeout(TIME);\n  // TIME = null;\n  // console.log(\"Timeout cleared\")\n  // e.preventDefault();\n  let overlay = document.getElementById(\"overlayL\");\n  if (overlay) {\n    overlay.style.opacity=\"0\";\n  }\n  let ele = document.getElementById(\"overlay\") as HTMLDivElement;\n  ele.innerHTML=\"\";\n  let p = document.getElementById(\"alerttext_v2\") as HTMLParagraphElement;\n  if (!ele || !p) {\n    console.log(\"ERROR: Alert dialogs not enabled in this page.\")\n    callback();\n    return;\n  }\n  \n  ele.style.opacity=\"1\";\n  ele = document.getElementById(\"internal_alerts\");\n  ele.style.opacity=\"1\";\n  ele.style.top = \"-100vh\";\n  ele.style.pointerEvents=\"auto\";\n  dialogQ = true;\n  cbk = callback;\n  p.innerText = str;\n  p.innerHTML += \"<p style='margin: 10px auto' class='gry nohover'>(Press any key to dismiss)</p>\"\n  document.getElementById(\"cancelBtn\").style.display = \"none\";\n  if (button == 1) {\n    p.innerHTML += `<button class='btn szThird fssml' id=\"refresh\" onclick='location.reload()'>\n    <span class=\"material-symbols-outlined\">history</span> Refresh?\n    <div class=\"anim\"></div></button>`\n    console.log(\"Failed request: \" + failedReq);\n    BLOCKCALLBACK = true;\n  }\n  else if (button == 2) {\n    document.getElementById(\"cancelBtn\").style.display = \"inline-block\";\n    console.log(\"Confirm speedbump\");\n    BLOCKCALLBACK = true;\n  }\n  if (failureTimeout) clearTimeout(failureTimeout);\n  failureTimeout = null;\n}\n\nfunction closeAlert(overrideCallback: boolean = false, overrideOverlay:boolean = false) {\n  let ele = document.getElementById(\"overlay\") as HTMLDivElement;\n  if (!ele) {\n    console.log(\"Alert dialogs not enabled in this page\");\n    return;\n  }\n  if (!overrideOverlay && !DIALOGOPEN) {\n    ele.style.opacity=0;\n    ele.style.pointerEvents=\"none\";\n  }\n  ele = document.getElementById(\"internal_alerts\");\n  ele.style.top = \"-50vh\";\n  ele.style.opacity=0;\n  ele.style.pointerEvents=\"none\";\n  dialogQ = false;\n  if (cbk && !overrideCallback) {\n    console.log(\"calling back\")\n    cbk();\n  }\n  BLOCKCALLBACK = false;\n}\n\nfunction keydown(e: Event) {\n  if (dialogQ) {\n    e.preventDefault();\n    if (BLOCKCALLBACK) closeAlert(true);\n    else {\n      console.log(\"KEYDOWNCLOSEDIALOG\")\n      closeAlert();\n    }\n  }\n}\n\nfunction toTime(ms: number) {\n  let day = Math.floor(ms / 1000 / 60 / 60 / 24);\n  ms = ms % (1000 * 60 * 60 * 24);\n  let hr = Math.floor(ms / 1000 / 60 / 60);\n  ms = ms % (1000 * 60 * 60);\n  let min = Math.floor(ms / 1000 / 60);\n  ms = ms % (1000 * 60);\n  let sec = Math.floor(ms / 1000);\n  if (ms < 0) return \"00:00:00\";\n  return (day > 0 ? day + \"d \" : \"\") + padWithZero(hr) + \":\" + padWithZero(min) + \":\" + padWithZero(sec);\n}\n\nfunction padWithZero(n: number) {\n  return n < 10 ? \"0\" + n : n;\n}\n\nlet overlay:HTMLDivElement;\naddEventListener(\"DOMContentLoaded\", function() {\n  overlay = document.createElement(\"div\");\n  overlay.className = \"overlayLoader\"\n  overlay.id = \"overlayL\";\n  // overlay.style.left=\"0vh\";\n  overlay.style.backgroundColor=\"var(--system-overlay)\";\n  overlay.style.opacity=\"1\";\n  overlay.innerHTML = `<span class=\"material-symbols-outlined loader\">sync</span>\n  <p class=\"loadp fslg grn nohover\">Loading.</p>`\n  // document.appendChild(document.createElement(\"body\"));\n  document.body.appendChild(overlay);\n  // console.log(document.body.innerHTML)\n});\n\nlet DIALOGOPEN = false;\nfunction closeDialog(thing:()=>any, name:string=\"dialog\") {\n  let div = document.getElementById(name);\n  div.style.top = \"50%\";\n  div.style.opacity=\"0\";\n  div.style.pointerEvents=\"none\";\n  DIALOGOPEN=false;\n  document.getElementById(\"overlay\").style.opacity = \"0\";\n  thing();\n  \n  // document.getElementById(\"startBtn\").focus();\n}\n\nfunction openDialog(name:string=\"dialog\") {\n  let div = document.getElementById(name);\n  div.style.top = \"0px\";\n  div.style.opacity=\"1\";\n  div.style.pointerEvents=\"auto\";\n  // ???\n  DIALOGOPEN=true;\n  document.getElementById(\"overlay\").style.opacity = \"1\";\n  // document.getElementById(\"startBtn\").focus();\n  // document.getElementById(\"startBtn\").focus();\n}\n\nfunction mouseOver(e:MouseEvent) {\n  let ele = e.target;\n  let text = ele.innerHTML.replaceAll(/<.*((>.*<\\/.*>)|(\\/>))/gmiu, \"\").replaceAll(\"\\n\", \"\").trim();\n  // fuck off this is good enough, it's not even used as raw html\n  if (ele.className.match(/(\\W|^)btn(\\W|$)/)) {\n    console.log(text)\n    let tooltip = ele.children.namedItem(\"TOOLTIP\");\n    if (!tooltip) {\n      tooltip = document.createElement(\"span\");\n      tooltip.innerText = text;\n      tooltip.id=\"TOOLTIP\";\n      tooltip.className=\"TOOLTIP override\"\n      ele.appendChild(tooltip);\n      ele.style.animation = 'none';  \n      console.log(\"reflowing\")\n      ele.offsetHeight; /* trigger reflow */   \n      ele.style.animation = null; \n    }\n  }\n}"],
  "mappings": "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",
  "names": ["cbk", "ele", "res", "overlay"]
}

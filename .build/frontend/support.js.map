{
  "version": 3,
  "sources": ["../../frontend/support.js"],
  "sourcesContent": ["function onLoad() {\n  // send(JSON.stringify({action:\"refresh\"}), (res)=>{\n  // });\n  // send(JSON.stringify({action:\"refresh_users\"}), (res)=>{\n  // });\n  document.getElementById(\"header\").innerHTML = \"Support: #\"+\n    document.URL.match(\"\\\\?room=(.*)\")[1];\n  ROOMNAME = document.URL.match(\"\\\\?room=(.*)\")[1];\n}\n// system refresh auto!\nfunction sendMsg() {\n  let inp = document.getElementById(\"msgInp\");\n  let match = inp.value.match(\"^!alias @(.+)\");\n  if (match) {\n    source.close();\n    \n    document.getElementById(\"userList\").innerHTML = ``;\n    send(JSON.stringify({action:\"realias\", data:{alias:match[1]}}), (res)=>{\n      if (res.status != \"SUCCESS\") alertDialog(\"ERROR: \"+res.data.error, ()=>{});\n      else alertDialog(\"Updated alias!\", ()=>{\n        document.getElementById(\"msgArea\").innerHTML = `<h2 id=\"placeholder\">\n        <span class=\"material-symbols-outlined\">update</span> \n        Reloading your messages, a moment please...</h2>`;\n        initClient();\n      });\n    });\n  }\n  else send(JSON.stringify({action:\"sendMsg\", data:{msg:inp.value, room:ROOMNAME}}), ()=>{});\n  inp.value=\"\";\n}\nlet LOADEDQ2 = false;\nconst rmvReg = /(>|^)\\-(.+)\\([0-9]\\)>/gm;\nconst addReg = /(>|^)\\+(.+)\\([0-9]\\)>/gm;\nconst classStr = [\"error\", \"user\", \"admin\", \"superadmin\"]\nlet source = null;\nasync function initClient()\n{\n  \n  try {\n  console.log(\"Starting client.\")\n  source = new EventSource('/stream?room='+\n                                 document.URL.match(\"\\\\?room=([0-9a-zA-Z\\\\-_]{1,20})$\")[1]);\n  source.addEventListener('message', message => {\n    console.log('Got', message);\n    ele = document.getElementById(\"userList\");\n    let modif = message.data;\n    \n\n    let removed = rmvReg.exec(modif);\n    let added = addReg.exec(modif)\n    while (removed || added) {\n      if (removed) {\n        ele.innerHTML= ele.innerHTML.replace(removed[2]+\"<br>\", \"\");\n      }\n      if (added) {\n        ele.innerHTML+= added[2]+\"<br>\";\n      }\n      modif = modif.replaceAll(rmvReg, \"\");\n      modif = modif.replaceAll(addReg, \"\");\n      removed = modif.match(rmvReg);\n      added = modif.match(addReg);\n    }\n    \n    ele = document.getElementById(\"msgArea\");\n    let scrDistOKQ =  (ele.scrollTop) >= (ele.scrollHeight-ele.offsetHeight - 100)\n    let msgs = modif.split(\">\");\n    for (let i=0; i<msgs.length; i++) {\n      let matches = msgs[i].match(/\\[(.+)\\]\\(([0-9])\\)(.*)/)\n      if (!matches) continue;\n      let newMsgBody = document.createElement(\"p\");\n      let newMsgSender = document.createElement(\"b\");\n      // parse things\n      newMsgSender.innerText = matches[1];\n      newMsgSender.className = classStr[matches[2]];\n      ele.appendChild(newMsgSender);\n      newMsgBody.className = classStr[matches[2]];\n      let msg = \" \"+matches[3].replaceAll(\"&gt;\", \";gt;\");\n      for (let i=0; i<replacements.length; i++) {\n        msg = msg.replaceAll(`:${replacements[i].from}:`, \">EMOJI\"+replacements[i].to+\">\");\n      }\n      let slashMe = false;\n      msg = msg.replaceAll(/(&[a-zA-Z0-9]{1,20}[^;])/gm,\">ROOM$1>\")\n      msg = msg.replaceAll(/(#[a-zA-Z0-9_\\-]{1,20}[^;])/gm,\">SUPPORT$1>\")\n      msg = msg.replaceAll(/((http|ftp|https):\\/\\/)?(?<test>([\\w_-]+(?:(?:\\.[\\w_-]+)+))([\\w.,@?^=%&:\\/~+#-]*[\\w@?^=%&\\/~+#-]))/gmiu,\">LINK$<test>>\")\n      msg = msg.replaceAll(/(`.*`)/gm,\">CODE$1>\")\n      if (msg.match(\"/me.*\")) {\n        msg = msg.slice(4);\n        slashMe = true;\n      }\n      \n      let split = msg.split(\">\");\n      // console.log(\"message fragments:\", split.length, split);\n      let out= \"\";\n      for (let i=0; i<split.length; i++) {\n        if (i%2 == 0) {\n          let fragment = document.createElement(\"p\");\n          fragment.className = classStr[matches[2]] + (slashMe?\" slashMe \":\"\");\n          fragment.innerText = split[i].replaceAll(\";gt;\", \">\");\n          ele.appendChild(fragment);\n        }\n        else {\n          let pref = split[i].match(\"^(EMOJI|LINK|ROOM|SUPPORT|CODE)\")[1];\n          let post = split[i].match(\"^(EMOJI|LINK|ROOM|SUPPORT|CODE)(.+)\")[2];\n          if (pref == \"EMOJI\") {\n            let replaced = document.createElement(\"span\");\n            replaced.title = \":\"+findReplacement(post)+\":\";\n            replaced.className=\"material-symbols-outlined supportMsg \"+classStr[matches[2]] + (slashMe?\" slashMe \":\"\");\n            replaced.innerText = post;\n            ele.appendChild(replaced);\n          }\n          else if (pref == \"LINK\") {\n            let replaced = document.createElement(\"a\");\n            replaced.className=\"supportMsg \"+classStr[matches[2]] + (slashMe?\" slashMe \":\"\");\n            replaced.href = \"https://\"+post;\n            replaced.innerText = post;\n            ele.appendChild(replaced);\n          }\n          else if (pref == \"ROOM\") {\n            let replaced = document.createElement(\"a\");\n            replaced.className=\"supportMsg \"+classStr[matches[2]] + (slashMe?\" slashMe \":\"\");\n            replaced.href = \"https://euphoria.io/room/\"+post.slice(1);\n            replaced.innerText = post;\n            ele.appendChild(replaced);\n          }\n          else if (pref == \"SUPPORT\") {\n            let replaced = document.createElement(\"a\");\n            replaced.className=\"supportMsg \"+classStr[matches[2]] + (slashMe?\" slashMe \":\"\");\n            replaced.href = \"/support?room=\"+post.slice(1);\n            replaced.innerText = post;\n            ele.appendChild(replaced);\n          }\n          else if (pref == \"CODE\") {\n            let replaced = document.createElement(\"kbd\");\n            replaced.className=\"supportMsg \"+classStr[matches[2]] + (slashMe?\" slashMe \":\"\");\n            // replaced.href = \"https://euphoria.io/room/\"+post.slice(1);\n            replaced.innerText = post;\n            ele.appendChild(replaced);\n          }\n        }\n      }\n      // let arr2 = msg.split(\":\");\n      // let arr3 = [];\n      // let prevColon = false;\n      // for (let j=0; j<arr2.length; j++) {\n      //   let idx;\n      //   arr3.push(false)\n      //   for (idx=0; idx<replacements.length && replacements[idx].from!=arr2[j]; idx++);\n      //   if (idx<replacements.length && i>0 && !arr3[j-1]) {\n      //     arr3[j] = true;\n      //     let replaced = document.createElement(\"span\");\n      //     replaced.className=\"material-symbols-outlined supportMsg \"+classStr[matches[2]];\n      //     replaced.innerText = replacements[idx].to;\n      //     ele.appendChild(replaced);\n      //   }\n      //   else {\n      //     msg = (!arr3[j-1]&&i>0?\":\":\"\")+arr2[j];\n      //     console.log(msg);\n      //     regex = new RegExp(\"(#[0-9a-zA-Z_\\\\-]{1,20})\", \"gmiu\");\n      //     while ((arr=regex.exec(msg))!== null) {\n      //       console.log(`Found ${arr[0]}. `, arr.index);\n      //       let fragment = document.createElement(\"span\");\n      //       fragment.className = classStr[matches[2]];\n      //       fragment.innerText = msg.slice(0, arr.index);\n      //       ele.appendChild(fragment);\n      //       let replaced = document.createElement(\"a\");\n      //       replaced.className=classStr[matches[2]];\n      //       replaced.href=\"/support?room=\"+arr[1].slice(1);\n      //       replaced.innerText = arr[1];\n      //       console.log(msg);\n      //       ele.appendChild(replaced);\n      //       msg = msg.slice(arr.index+arr[1].length);\n      //     } // link detection\n      //     let fragment = document.createElement(\"span\");\n      //     fragment.className = classStr[matches[2]];\n      //     fragment.innerText = msg;\n      //     ele.appendChild(fragment);\n      //   }\n      // }\n      \n      // do this sometime soon. \n      // msg = msg.replaceAll(\"&gt;\", \">\");\n      // start replacing emojis\n      // replaceAll(msg, ele, matches);\n      // newMsgBody.innerText = msg; // but of course.\n      \n      // if (split.length <= 2) ele.appendChild(newMsgBody);\n      ele.appendChild(document.createElement(\"br\"));\n      document.getElementById(\"placeholder\").style.display=\"none\";\n    } // \n    \n    if (!LOADEDQ2 || scrDistOKQ)\n    {\n      ele.scrollTop = ele.scrollHeight;\n      // console.log(\"Scrolling to bottom.\")\n      LOADEDQ2 = true;\n    }\n\n    \n  });\n  } catch (e) {\n    console.log(\"Restartng client (\"+e+\")\")\n    setTimeout(initClient, 0);\n  }\n} // initClient();\n\n\nconst replacements = [\n  {from: \"one\", to: \"counter_1\"},\n  {from: \"two\", to: \"counter_2\"},\n  {from: \"three\", to: \"counter_3\"},\n  {from: \"four\", to: \"counter_4\"},\n  {from: \"five\", to: \"counter_5\"},\n  {from: \"six\", to: \"counter_6\"},\n  {from: \"seven\", to: \"counter_7\"},\n  {from: \"eight\", to: \"counter_8\"},\n  {from: \"nine\", to: \"counter_9\"},\n  {from: \"zero\", to: \"counter_0\"},\n  {from: \"white_check_mark\", to: \"check_circle\"},\n  {from: \"active\", to: \"check_circle\"},\n  {from: \"info\", to: \"info\"},\n  {from: \"confirm\", to:\"check\"},\n  {from: \"warn\", to: \"warning\"},\n  {from: \"error\", to:\"error\"},\n  {from: \"egg\", to:\"egg_alt\"}\n]\n\n// function replaceAll(msg, ele, matches) {\n//   console.log(msg, ele, matches);\n//   for (let j=0; j<replacements.length; j++) {\n//     let regex = new RegExp(replacements[j].from, \"gmiu\");\n//     while ((arr = regex.exec(msg)) !== null) {\n//       console.log(`Found ${arr[0]}. `, arr.index);\n//       let fragment = document.createElement(\"span\");\n//       fragment.className = classStr[matches[2]];\n//       console.log(msg.slice(0, arr.index));\n//       if (msg.slice(0, arr.index)) replaceAll(msg.slice(0, arr.index), ele, matches);\n//       let replaced = document.createElement(\"span\");\n//       replaced.className=\"material-symbols-outlined supportMsg \"+classStr[matches[2]];\n//       replaced.innerText = replacements[j].to;\n//       console.log(replaced);\n//       ele.appendChild(replaced);\n//       msg = msg.slice(arr.index+replacements[j].from.length);\n//       console.log(msg);\n//     }\n//   } // for replacements\n// }\n\nfunction findReplacement(thing) {\n  for (let i=0; i<replacements.length; i++) {\n    if (replacements[i].to == thing) return replacements[i].from;\n  }\n}"],
  "mappings": "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",
  "names": ["i"]
}

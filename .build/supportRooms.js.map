{
  "version": 3,
  "sources": ["../supportRooms.ts"],
  "sourcesContent": ["import {userRequest} from './userRequest';\nimport {msgDB, authDB, uDB, roomRegex} from './consts';\nimport {log} from './logging'\nimport {minID} from  './database';\nimport { WebH } from './betautilities/webHandler';\nexport class Room {\n  type:string;\n  name:string;\n  handler: WebH|null;\n  constructor(type:string, name:string, responder:((msg:string, sender:string, data:any)=>any)|null=null, handler: WebH|null=null) {\n    this.type=type;\n    this.name=name;\n    this.handler = handler;\n  };\n\n}\n\nexport class pseudoConnection {\n  write(thing:any) {}\n  close () {}\n};\n\nexport class supportHandler {\n  static allRooms: Room[] = [];\n  static connectionCt = 0;\n  static connections: {event:any, roomName:string, tk:string, readyQ:boolean, isPseudoConnection:boolean}[] = [];\n  static addRoom(rm:Room) {\n    log(\"Room created!\" + rm)\n    let idx = this.allRooms.findIndex((r:any)=>{return r.type==rm.type && r.name==rm.name});\n    if (idx >= 0) return;\n    else this.allRooms.push(rm);\n  }\n  static deleteRoom(type:string, roomName:string) {\n    log(\"Room deleted!\" +  type+ roomName);\n    let idx = this.allRooms.findIndex((r:any)=>{return r.type==type && r.name==roomName});\n    if (idx >= 0) this.allRooms.splice(idx, 1);\n  }\n  static async addConnection(ev:any, rn:string, token:string, internalFlag:boolean=false) {\n    // send existing connections to THIS EVENT ONLY\n    this.connectionCt++;\n    if (internalFlag) \n    {\n      token = \"[SYSINTERNAL]\";\n    }\n    for (let i=0; i<this.connections.length; i++) {\n      if (this.connections[i].roomName == rn)\n        userRequest(this.connections[i].tk, this.connections[i].isPseudoConnection).then((obj:{status:string, data:any, token:string})=>{\n          if (obj.status == \"SUCCESS\") {\n            ev.write(\"data:+\"+obj.data.alias+\"(\"+obj.data.perms+\")>\\n\\n\");\n          }\n          else {\n            ev.write(\"data:+\"+processAnon(this.connections[i].tk)+\"(1)>\\n\\n\");\n          }\n        });\n    }\n    // add NEW CONNECTION\n    let thiscn = {id:this.connectionCt, event:ev, roomName:rn, tk:token, readyQ:false, isPseudoConnection:internalFlag};\n    this.connections.push(thiscn);\n    // TELL EVERYONE ELSE ABOUT THE NEW CONNECTION\n    userRequest(token, internalFlag).then((obj:{status:string, data:any, token:string})=>{\n      if (obj.status == \"SUCCESS\") this.sendMsgTo(rn, \"+\"+obj.data.alias+\"(\"+obj.data.perms+\")\");\n      else this.sendMsgTo(rn, \"+\"+processAnon(obj.token)+\"(1)\");\n    });\n    // console.log(\"added connection in \"+rn);\n    let roomData = await msgDB.findOne({fieldName:\"RoomInfo\", room:{$eq:rn}});\n    let msgCt = roomData?roomData.msgCt:0;\n    let msgs = await msgDB.find({fieldName:\"MSG\", room:{$eq:rn}, msgID:{$gt: msgCt-30}}).toArray();\n    let text = \"\";\n    ev.write(\"data:CONNECTIONID \"+this.connectionCt+\">\\n\\n\");\n    for (let i=0; i<msgs.length; i++) {\n      // let userData = await authDB.findOne({fieldName:\"UserData\", user:msgs[i].sender})\n      // if (!userData) text+= \"[\"+msgs[i].sender+\"](1)\"+msgs[i].data+\">\";\n      // if (!userData) ev.write(\"data:[\"+msgs[i].sender+\"](1)\"+msgs[i].data+\">\\n\\n\");\n      // else text += \"[\"+(userData.alias??msgs[i].sender)+\"](\"+userData.permLevel+\")\"+msgs[i].data+\">\";\n      ev.write(\"data:{\"+/*(Math.random()<0.5?\"-\":\"\")+*/(msgs[i].msgID??-1)+\"}[\"+(msgs[i].sender)+\"](\"+msgs[i].permLevel+\")\"+msgs[i].data+\">\\n\\n\");\n    }\n    text += `{${msgCt+1}}`+\"[SYSTEM](3)Welcome to BetaOS Services support! Enter any message in the box below. \"+\n      \"Automated response services and utilities are provided by BetaOS System. \"+\n      \"Commands are available here: &gt;&gt;commands \\n\"+\n      \"Enter !alias @[NEWALIAS] to re-alias yourself. Thank you for using BetaOS Systems!>\"\n    ev.write(\"data:\"+text+\"\\n\\n\");\n    thiscn.readyQ = true;\n  }\n  static async removeConnection(ev:any, rn:string, token:string) {\n    let idx = this.connections.findIndex((cn:any)=>cn.event == ev);\n    if (idx >= 0) this.connections.splice(idx, 1);\n    \n    userRequest(token).then((obj:{status:string, data:any, token:string})=>{\n      if (obj.status == \"SUCCESS\") this.sendMsgTo(rn, \"-\"+obj.data.alias+\"(\"+obj.data.perms+\")\");\n      else this.sendMsgTo(rn, \"-\"+processAnon(obj.token)+\"(1)\");\n      // console.log(\"removed connection in \"+rn); \n    });\n  }\n  \n  static listRooms(euphOnlyQ:boolean, onlineOnlyQ:boolean) {\n    if(euphOnlyQ) {\n      return this.listEuphRooms();\n    }\n    else if (onlineOnlyQ) {\n      return this.listOnlineRooms();\n    }\n    else {\n      return this.listAllRooms();\n    }\n  }\n  \n  static listAllRooms() {\n    let out = [];\n    for (let i=0; i<this.allRooms.length; i++) {\n      if (this.allRooms[i].type == \"HIDDEN_SUPPORT\") continue;\n      out.push(this.getPrefix(this.allRooms[i].type)+this.allRooms[i].name);\n    }\n    return out;\n  }\n  \n  static listEuphRooms() {\n    let out = [];\n    for (let i=0; i<this.allRooms.length; i++) {\n      if (this.allRooms[i].type != \"EUPH_ROOM\") continue;\n      out.push(this.getPrefix(this.allRooms[i].type)+this.allRooms[i].name);\n    }\n    return out;\n  }\n  \n  static listOnlineRooms() {\n    let out = [];\n    for (let i=0; i<this.allRooms.length; i++) {\n      if (this.allRooms[i].type != \"ONLINE_SUPPORT\") continue;\n      out.push(this.getPrefix(this.allRooms[i].type)+this.allRooms[i].name);\n    }\n    return out;\n  }\n\n  static getPrefix(type:string) {\n    switch(type) {\n      case 'EUPH_ROOM': return \"&\";\n      case 'ONLINE_SUPPORT': return \"#\";\n      default: return \"??\";\n    }\n  }\n  \n  static checkFoundQ(roomName:string) {\n    try {\n      for (let i=0; i<this.allRooms.length; i++) {\n        if (this.allRooms[i].name == roomName && this.allRooms[i].type != \"EUPH_ROOM\") return true;\n      }\n      return false;\n    } catch (e:any) {\n    console.log(\"Error:\",e);\n    }\n  }\n\n  static mitoseable(roomName:string) {\n     for (let i=0; i<this.allRooms.length; i++) {\n      if (this.allRooms[i].name == roomName && this.allRooms[i].type == \"EUPH_ROOM\") return true;\n    }\n    return false;\n  }\n  static sendMsgTo(roomName:string, data:string) {\n    for (let i=0; i<this.connections.length; i++) {\n      if (this.connections[i].roomName == roomName) {\n        // encode '>' -- used for message-breaks (yes, it is stupid.)\n        data = data.replaceAll(\">\", \"&gt;\");\n        this.connections[i].event.write(\"data:\"+data+\">\\n\\n\")\n      }\n    }\n    \n  }\n\n  static sendMsgTo_ID(connectionID:number, data:string) {\n    for (let i=0; i<this.connections.length; i++) {\n      if (this.connections[i].id == connectionID) {\n        // encode '>' -- used for message-breaks (yes, it is stupid.)\n        data = data.replaceAll(\">\", \"&gt;\");\n        \n        this.connections[i].event.write(\"data:\"+data+\">\\n\\n\")\n        \n      }\n    }\n  }  \n}\n\nexport function sendMsg(msg:string, room:string, token:string, callback: (status:string, data:any, token:string)=>any) {\n  userRequest(token).then(async (obj:{status:string, data:any, token:string})=>{\n    let roomData = await msgDB.findOne({fieldName:\"RoomInfo\", room:room});\n    let msgCt = roomData?roomData.msgCt:0;\n    await msgDB.insertOne({fieldName:\"MSG\", data:msg.replaceAll(\">\", \"&gt;\"), permLevel:obj.data.perms??1, \n                             sender:obj.data.alias??\"\"+processAnon(token), expiry:Date.now()+3600*1000*24*30, \n                           room:room, msgID:msgCt});\n    await msgDB.updateOne({room:room, fieldName:\"RoomInfo\"}, {\n      $inc: {msgCt:1}\n    }, {upsert: true});\n    if (obj.status == \"SUCCESS\") {\n      supportHandler.sendMsgTo(room, \"{\"+msgCt+\"}[\"+obj.data.alias+\"](\"+obj.data.perms+\")\"+msg);\n    }\n    else {\n      //console.log(\"sending\")\n      supportHandler.sendMsgTo(room, \"{\"+msgCt+\"}[\"+processAnon(token)+\"](1)\"+msg);\n    }\n    //console.log(supportHandler.allRooms);\n    for (let i=0; i<supportHandler.allRooms.length; i++) {\n      if (supportHandler.allRooms[i].name == room) {\n        // console.log(\"sending\"+msg);\n        supportHandler.allRooms[i].handler.onMessage(msg, obj.data.alias??processAnon(token))\n      }\n \n    }\n    callback(\"SUCCESS\", null, token);\n  });\n}\n\nexport async function sendMsg_B(msg:string, room:string) {\n  let roomData = await msgDB.findOne({fieldName:\"RoomInfo\", room:room});\n  let msgCt = roomData?roomData.msgCt:0;\n  await msgDB.insertOne({fieldName:\"MSG\", data:msg, permLevel:3, \n                           sender:\"BetaOS_System\", expiry:Date.now()+3600*1000*24*30, \n                         room:room, msgID:msgCt});\n  await msgDB.updateOne({room:room, fieldName:\"RoomInfo\"}, {\n      $inc: {msgCt:1}\n    }, {upsert: true});\n  supportHandler.sendMsgTo(room, \"{\"+msgCt+\"}[BetaOS_System](3)\"+msg);\n}\n\nfunction processAnon(token:string) {\n  return \"Anonymous user\";\n}\n\nexport function roomRequest(token:string, all:boolean=false) {\n  if (all) return {status: \"SUCCESS\", data:supportHandler.listAllRooms(), token:token};\n  else return {status: \"SUCCESS\", data:supportHandler.listOnlineRooms(), token:token};\n}\n\nexport async function createRoom(name:string, token:string) {\n  if (supportHandler.checkFoundQ(name)) return {status:\"ERROR\", data:{error:\"Room already exists\"}, token:token};\n  let usrData = await userRequest(token) as {status:string, data:{perms:number}};\n  if (!name.match(\"^\"+roomRegex+\"$\")) return {status:\"ERROR\", data:{error:\"Invalid roomname!\"}, token:token};\n  if (usrData.status == \"SUCCESS\") {\n    if (usrData.data.perms >= 2) {\n      \n      // supportHandler.addRoom(new Room(\"ONLINE_SUPPORT\", name));\n      new WebH(name, false);\n      let obj = await uDB.findOne({fieldName:\"ROOMS\"});\n      obj.rooms.push(name);\n      await uDB.updateOne({fieldName:\"ROOMS\"}, {\n        $set: {\n          rooms: obj.rooms\n        },\n      }, {upsert:true});\n      return {status:\"SUCCESS\", data:null, token:token}\n    }\n    else return {status:\"ERROR\", data:{error:\"Access denied!\"}, token:token};\n  }\n  else return usrData;\n}\n\nexport async function deleteRoom(name:string, token:string) {\n  if (!supportHandler.checkFoundQ(name)) return {status:\"ERROR\", data:{error:\"Room does not exist\"}, token:token};\n  let usrData = await userRequest(token) as {status:string, data:{perms:number}};\n  if (!name.match(\"^\"+roomRegex+\"$\")) return {status:\"ERROR\", data:{error:\"Invalid roomname!\"}, token:token};\n  if (usrData.status == \"SUCCESS\") {\n    if (usrData.data.perms >= 2) {\n\n      let obj = await uDB.findOne({fieldName:\"ROOMS\"})\n      let idx = obj.rooms.indexOf(name); \n      if (idx>=0) {\n        supportHandler.deleteRoom(\"ONLINE_SUPPORT\", name);\n        obj.rooms.splice(idx, 1);\n        await uDB.updateOne({fieldName:\"ROOMS\"}, {\n          $set: {\n            rooms: obj.rooms\n          },\n        }, {upsert:true});\n        return {status:\"SUCCESS\", data:null, token:token}\n      }\n      else {\n        let idx = obj.hidRooms.indexOf(name); \n        if (idx>=0) {\n          supportHandler.deleteRoom(\"HIDDEN_SUPPORT\", name);\n          obj.hidRooms.splice(idx, 1);\n        }\n        else return {status:\"ERROR\", data:{error: \"Database inconsistency detected\"}, token:token};\n        await uDB.updateOne({fieldName:\"ROOMS\"}, {\n          $set: {\n            hidRooms: obj.hidRooms\n          },\n        }, {upsert:true});\n        return {status:\"SUCCESS\", data:null, token:token}\n      }\n    }\n    else return {status:\"ERROR\", data:{error:\"Access denied!\"}, token:token};\n  }\n  else return usrData;\n}\n\nexport function updateActive(name:string, activeQ: boolean) {\n  if (activeQ) supportHandler.addRoom(new Room(\"EUPH_ROOM\", name));\n  else supportHandler.deleteRoom(\"EUPH_ROOM\", name);\n}\n\nexport async function WHOIS(token:string, user:string) {\n  let userData = await authDB.findOne({fieldName:\"UserData\", user:user});\n  let userData2 = await authDB.find({fieldName:\"UserData\", alias:user}).toArray();\n  let out = [];\n  for (let i=0; i<userData2.length; i++) {\n    out.push({user:userData2[i].user, \n              tasks: userData2[i].tasksCompleted,\n              about:userData2[i].aboutme,\n              perms: userData2[i].permLevel})\n  }\n  return {status:\"SUCCESS\", data:{account:{\n    perms:userData?userData.permLevel:\"N/A\", \n    user:user, \n    tasks:userData?userData.tasksCompleted:\"N/A\",\n    about:userData?userData.aboutme:\"Account not found\"\n  }, users:out}, token:token};\n}\n\n//loadLogs(data.room, data.id, data.from token)\nexport async function loadLogs(rn:string, id:string, from:number, token:string) {\n  try {\n  let roomInfo = await msgDB.findOne({fieldName:\"RoomInfo\", room:{$eq:rn}});\n  from = +from;\n  console.log(\"LOADING LOGS FROM\",from-30,\"TO\",from);\n  if (from<minID || (roomInfo && roomInfo.minCt && from < roomInfo.minCt)) {\n    supportHandler.sendMsgTo_ID(id, \"LOADCOMPLETE -1\");\n    return {status:\"SUCCESS\", data:null, token:token}\n  }\n  let msgs = await msgDB.find({fieldName:\"MSG\", room:{$eq:rn}, msgID:{$gt: from-30, $lt: from}}).toArray();\n  for (let i=msgs.length-1; i>=0; i--) {\n    // console.log(msgs[i]);\n    let dat = \"{\"+(-msgs[i].msgID)+\"}[\"+(msgs[i].sender)+\"](\"+msgs[i].permLevel+\")\"+msgs[i].data;\n    // console.log(dat);\n    supportHandler.sendMsgTo_ID(id, dat);\n  }\n  console.log(\"LOADING COMPLETE, LOADED\"+msgs.length,\"MESSAGES\");\n  supportHandler.sendMsgTo_ID(id, \"LOADCOMPLETE \"+(from-30));\n  return {status:\"SUCCESS\", data:null, token:token};\n  } catch (e:any) {\n    console.log(\"Error:\",e);\n  }\n} // loadLogs\n\nexport async function delMsg(id:string, room:string, token:string) {\n  try {\n  // console.log({fieldName:\"MSG\", msgID:id, room:room});\n  if (!supportHandler.checkFoundQ(name)) return {status:\"ERROR\", data:{error:\"Room does not exist\"}, token:token};\n  let usrData = await userRequest(token) as {status:string, data:{perms:number}};\n  if (usrData.status != \"SUCCESS\") return usrData;\n  if (usrData.perms < 2) return {status:\"ERROR\", data:{error:\"Insufficient permissions!\"}, token:token};\n  await msgDB.deleteOne({fieldName:\"MSG\", msgID:Number(id), room:room});\n  return {status:\"SUCCESS\", data:null, token:token};\n  } catch (e:any) {\n    console.log(\"Error:\",e);\n  }\n}\n\nexport async function updateDefaultLoad(name:string[], token:string) {\n  try {\n  let usrData = await userRequest(token) as {status:string, data:{perms:number}};\n  if (usrData.status != \"SUCCESS\") return usrData;\n  // console.log(usrData.data.perms);\n  if (usrData.data.perms < 3) return {status:\"ERROR\", data:{error:\"Insufficient permissions!\"}, token:token};\n  for (let i=0; i<name.length; i++) {\n    if (!name[i].match(\"^\"+roomRegex+\"$\")) return {status:\"ERROR\", data:{error:\"Invalid room-name(s)\"}, token:token}\n  }\n  await uDB.updateOne({fieldName:\"ROOMS\"}, {$set:{\n    euphRooms:name\n  }});\n  return {status:\"SUCCESS\", data:null, token:token};\n  } catch (e:any) {\n    console.log(\"Error:\",e);\n  }\n}\n\nexport async function hidRoom(name:string, token:string) {\n  try {\n  console.log(name);\n  if (supportHandler.checkFoundQ(name)) return {status:\"ERROR\", data:{error:\"Room already exists\"}, token:token};\n  let usrData = await userRequest(token) as {status:string, data:{perms:number}};\n  if (!name.match(\"^\"+roomRegex+\"$\")) return {status:\"ERROR\", data:{error:\"Invalid roomname!\"}, token:token};\n  if (usrData.status == \"SUCCESS\") {\n    if (usrData.data.perms >= 2) {\n      \n      // supportHandler.addRoom(new Room(\"ONLINE_SUPPORT\", name));\n      new WebH(name, false);\n      let obj = await uDB.findOne({fieldName:\"ROOMS\"});\n      obj.hidRooms.push(name);\n      await uDB.updateOne({fieldName:\"ROOMS\"}, {\n        $set: {\n          hidRooms: obj.hidRooms\n        },\n      }, {upsert:true});\n      return {status:\"SUCCESS\", data:null, token:token}\n    }\n    else return {status:\"ERROR\", data:{error:\"Access denied!\"}, token:token};\n  }\n  else return usrData;\n  } catch (e:any) {\n    console.log(\"Error:\",e);\n  }\n}\n\nexport async function purge(name:string, token:string) {\n  try {\n  if (!supportHandler.checkFoundQ(name)) return {status:\"ERROR\", data:{error:\"Room does not exist\"}, token:token};\n  let usrData = await userRequest(token) as {status:string, data:{perms:number}};\n  if (usrData.status != \"SUCCESS\") return usrData;\n  // console.log(usrData.data.perms);\n  if (usrData.data.perms < 3) return {status:\"ERROR\", data:{error:\"Insufficient permissions!\"}, token:token};\n\n  await msgDB.deleteMany({fieldName:\"MSG\", room:name});\n  await msgDB.updateOne({fieldName:\"RoomInfo\", room:name}, {$set:{\n    msgCt:0\n  }})\n  return {status:\"SUCCESS\", data:null, token:token};\n  } catch (e:any) {\n    console.log(\"Error:\",e);\n  }\n}\n\nexport async function updateAbout(about:string, token:string) {\n  let usrData = await userRequest(token) as {status:string, data:{perms:number}};\n  if (usrData.status != \"SUCCESS\") return usrData;\n  await authDB.updateOne({fieldName:\"UserData\", user:usrData.data.user}, {$set:{\n    aboutme: about\n  }})\n  return {status:\"SUCCESS\", data:null, token:token}\n}"],
  "mappings": "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",
  "names": ["name", "idx"]
}
